// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(r,m,d,t,g,b,q,z){r=r([b,q],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(b,h){m.mixin(this,h);this.initialize(b,h)},getTitle:function(b){var h;this.info&&(h=this.titleHasRelatedFields||this.titleHasAsyncExpressions?"":this._getPopupValues(b,
this._fetchAttributes(b,null,this.getExpressionFieldsInTitle()),!0).title);return h||""},getContent:function(b){return this.info?(new z({template:this,graphic:b,chartTheme:this.chartTheme},t.create("div"))).domNode:""}});d("extend-esri")&&m.setObject("dijit.PopupTemplate",r,g);return r})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(r,m,d,t,g,b,q,z,n,h,u,D,y,A,C,B,G,k,c,v,x,w){r=r(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(a,e){if(a){m.mixin(this,e);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var p=this._fieldLabels={},l=this._fieldsMap={};this.info.fieldInfos&&
d.forEach(this.info.fieldInfos,function(a){var f=a.fieldName.toLowerCase(),e=this._isExpressionField(f)?this.getExpressionInfo(f):null;p[f]=e?e.title:a.label;l[f]=a},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return t.fromJson(t.toJson(this.info))},getTitle:function(){},getContent:function(){},
getFieldInfo:function(a){var e;d.some(this.info&&this.info.fieldInfos,function(p){p.fieldName===a&&(e=p);return!!e});return e},getExpressionInfo:function(a){if(a=this._getExprField(a)){a=a.toLowerCase();var e;d.some(this.info.expressionInfos,function(p){p.name.toLowerCase()===a&&(e=p);return!!e});return e}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var a=this._collectExprFieldsFromTemplatedString(this.info.description,
[]);this.info.description||d.forEach(this.info.fieldInfos,function(e){e.visible&&this._collectExprField(e.fieldName,a)},this);d.forEach(this.info.mediaInfos,function(e){this._collectExprFieldsFromTemplatedString(e.title,a);this._collectExprFieldsFromTemplatedString(e.caption,a);if(e=e.value)this._collectExprFieldsFromTemplatedString(e.linkURL,a),this._collectExprFieldsFromTemplatedString(e.sourceURL,a),d.forEach(e.fields,function(e){this._collectExprField(e,a)},this),this._collectExprField(e.normalizeField,
a),this._collectExprField(e.tooltipField,a)},this);return a},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return d.some(this._getArcadeExpressions(),function(a){return a.hasGeometryOperations()})},hasAsyncExpressions:function(){return d.some(this._getArcadeExpressions(),function(a){return a.async})},initializeArcadeEngine:function(){return v.initialize(this._getArcadeExpressions())},getComponents:function(a,
e){var p=this.info,l={initArcadeEngine:this.initializeArcadeEngine()};p.fieldInfos&&(p=d.filter(p.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<p.length&&(l.relatedInfo=this._getRelatedRecords({graphic:a,fieldsInfo:p}));this._needFullResolutionFeature(a)&&(l.fullResolutionFeature=this._getFullResolutionFeature(a));return A(l).then(m.hitch(this,function(l){l=l.fullResolutionFeature;var f=e&&e.evaluateAllExpressions,p=f?null:this.getRequiredExpressionFields();
l=(f?this.hasAsyncExpressions():this._hasAsyncExpressions(p))?this._fetchAttributesAsync(a,l,p):this._fetchAttributes(a,l,p);return A([l]).then(m.hitch(this,function(l){return this._getPopupValues(a,l[0])}))}))},getAttachments:function(a){var e=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&e&&e.hasAttachments&&e.objectIdField&&(a=a&&a[e.objectIdField]))return e.queryAttachmentInfos(a)},_needFullResolutionFeature:function(a){return(a=a.getSourceLayer())?"function"===typeof a.getMaxAllowableOffset&&
0<a.getMaxAllowableOffset()&&this.hasGeometryOperations():!1},_getFullResolutionFeature:function(a){var e=a.getSourceLayer(),p=e.objectIdField;a=(a=a.attributes)&&p&&a[p];if(null==a)return null;var l=new B;l.where=p+"\x3d"+a;l.maxAllowableOffset=0;l.outFields=[p];e._enableCacheHint(l);return e.queryFeatures(l).then(function(a){return a.features&&a.features[0]})},_isExpressionField:function(a){return this._reExprField.test(a)},_getExprField:function(a){return this._isExpressionField(a)?a.replace(this._reExprField,
""):null},_collectExprField:function(a,e){(a=this._getExprField(a))&&e.push(a);return e},_collectExprFieldsFromTemplatedString:function(a,e){a=this._getExprFieldsFromTemplatedString(a);a.length&&Array.prototype.push.apply(e,a);return e},_getExprFieldsFromTemplatedString:function(a){a=a?a.match(this._reExprFieldPattern):null;return d.map(a,function(a){return a.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},
_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},_hasAsyncExpressions:function(a){return d.some(a,function(a){a=this._exprCache[a];return!(!a||!a.async)},this)},_compileExpressions:function(a){var e={};d.forEach(a,function(a){var l=a.returnType&&a.returnType.toLowerCase();e[a.name]=new C({expression:a.expression,returnType:"number"===l?"number":"string",profile:v})});return e},_getArcadeExpressions:function(){var a=[],e;for(e in this._exprCache)a.push(this._exprCache[e]);
return a},_fetchAttributesAsync:function(a,e,p){var l=this._fetchAttributes(a,e,p);a={};for(var f in l)(e=l[f])&&e.then&&(a[f]=e);return A(a).then(m.hitch(this,function(a){for(var f in a){var e=a[f];l[f]=e instanceof Error?null:this._processArcadeResult(e)}return l}))},_processArcadeResult:function(a){"string"===typeof a&&(a=h.encode(a));return a},_fetchAttributes:function(a,e,p){var l=m.clone(a.attributes)||{},f=e&&e.geometry,c=this._exprPrefix,k=this._exprCache;p=p||d.map(this.info.expressionInfos,
function(a){return a.name});d.forEach(p,function(e){var p=c+e;e=(e=k[e])?a.evaluateExpression(e,this._getEvalOptions(e,a,f)):null;l[p]=this._processArcadeResult(e)},this);return l},_getEvalOptions:function(a,e,p){var l=a.hasGeometryOperations(),f=e.getSourceLayer(),c=f&&(f.getMap()||f.parentLayer&&f.parentLayer.getMap());a=v.getEvalOptions({expression:a,feature:e,layer:f,map:c,spatialReference:c&&c.spatialReference});e=a.context.vars.$feature;l=!(!l||!p);e&&l&&(e._geometry=p);a.skipCache=l;return a},
_getPopupValues:function(a,e,p){e=e||this._fetchAttributes(a);var l=this.info,f=a.getSourceLayer(),c=m.clone(e),k="",b="",w,h,v,n,x,q=f&&f._getDateOpts&&f._getDateOpts().properties,q=q&&q.slice(0),g={dateFormat:{properties:q,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(n in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(n)){var y=this._relatedInfo[n],z=this._relatedLayersInfo[n];y&&(d.forEach(y.relatedFeatures,function(a){for(x in a.attributes)if(a.attributes.hasOwnProperty(x)&&
"esriRelCardinalityOneToOne"===z.relation.cardinality){var l=this._toRelatedFieldName([z.relation.id,x]);e[l]=c[l]=a.attributes[x]}},this),d.forEach(y.relatedStatsFeatures,function(a){for(x in a.attributes)if(a.attributes.hasOwnProperty(x)){var l=this._toRelatedFieldName([z.relation.id,x]);e[l]=c[l]=a.attributes[x]}},this))}for(h in c)n=this._fieldsMap[h.toLowerCase()],y=this._getLayerFieldInfo(f,h),n&&y&&(n.fieldName=y.name),c[h]=this._formatValue(c[h],h,g),q&&n&&n.format&&n.format.dateFormat&&(n=
d.indexOf(q,h),-1<n&&q.splice(n,1));if(f)for(h in q=f.typeIdField,e)e.hasOwnProperty(h)&&-1===h.indexOf(this._relatedFieldPrefix)&&(v=e[h],u.isDefined(v)&&(n=this._getDomainName(f,a,h,v),u.isDefined(n)?c[h]=n:h===q&&(n=this._getTypeName(f,a,v),u.isDefined(n)&&(c[h]=n))));l.title&&(k=this._processFieldsInLinks(this._fixTokens(l.title,f),e),k=m.trim(this._removeEmptyHref(u.substitute(c,k,g)||"")));if(p)return{title:k};l.description&&(b=this._processFieldsInLinks(this._fixTokens(l.description,f),e),
b=m.trim(this._removeEmptyHref(u.substitute(c,b,g)||"")));l.fieldInfos&&(w=[],d.forEach(l.fieldInfos,function(a){(h=a.fieldName)&&a.visible&&w.push([this._fieldLabels[h.toLowerCase()]||h,u.substitute(c,"${"+h+"}",g)||""])},this));var t,r;l.mediaInfos&&(t=[],d.forEach(l.mediaInfos,function(a){r=0;v=a.value;switch(a.type){case "image":var l=v.sourceURL,l=l&&m.trim(this._removeEmptyHref(u.substitute(e,this._fixTokens(l,f))));r=!!l;break;case "piechart":case "linechart":case "columnchart":case "barchart":var p,
l=v.normalizeField;v.fields=d.map(v.fields,function(a){return(p=this._getLayerFieldInfo(f,a))?p.name:a},this);l&&(p=this._getLayerFieldInfo(f,l),v.normalizeField=p?p.name:l);r=d.some(v.fields,function(a){return u.isDefined(e[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(r){a=m.clone(a);v=a.value;var l=a.title?this._processFieldsInLinks(this._fixTokens(a.title,f),e):"",k=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,f),e):"";a.title=
l?m.trim(this._removeEmptyHref(u.substitute(c,l,g)||"")):"";a.caption=k?m.trim(this._removeEmptyHref(u.substitute(c,k,g)||"")):"";if("image"===a.type)v.sourceURL=u.substitute(e,this._fixTokens(v.sourceURL,f)),v.linkURL&&(v.linkURL=m.trim(u.substitute(e,this._fixTokens(v.linkURL,f))||""));else{var E,b;d.forEach(v.fields,function(a,l){if(-1!==a.indexOf(this._relatedFieldPrefix))b=this._getRelatedChartInfos(a,v,e,g),b instanceof Array?v.fields=b:v.fields[l]=b;else{var f=e[a],f=void 0===f?null:f;E=e[v.normalizeField]||
0;f&&E&&(f/=E);v.fields[l]={y:f,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(f,a,g,!!E)}}},this)}t.push(a)}},this));return{title:k,description:b,hasDescription:!!l.description,fields:w&&w.length?w:null,mediaInfos:t&&t.length?t:null,formatted:c,editSummary:!1!==l.showLastEditInfo&&f&&f.getEditSummary?f.getEditSummary(a):""}},_getRelatedChartInfos:function(a,e,p,l){var f,c,k,b,v,h;f=[];h=this._fromRelatedFieldName(a);v=h[0];c=this._relatedInfo[v];v=this._relatedLayersInfo[v];
c&&d.forEach(c.relatedFeatures,function(c){c=c.attributes;var E,v;for(v in c)if(c.hasOwnProperty(v)&&v===h[1]){E={};b=c[v];e.normalizeField&&(k=-1!==e.normalizeField.indexOf(this._relatedFieldPrefix)?c[this._fromRelatedFieldName(e.normalizeField)[1]]:p[e.normalizeField]);b&&k&&(b/=k);if(e.tooltipField)if(-1!==e.tooltipField.indexOf(this._relatedFieldPrefix)){var n=this._fromRelatedFieldName(e.tooltipField)[1],w=u.isDefined(c[n])?this._formatValue(c[n],e.tooltipField,l,!!k):n;E.tooltip=w+":\x3cbr/\x3e"+
this._formatValue(b,n,l,!!k)}else E.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(b,e.tooltipField,l,!!k);else E.tooltip=b;E.y=b;f.push(E)}},this);return"esriRelCardinalityOneToMany"===v.relation.cardinality||"esriRelCardinalityManyToMany"===v.relation.cardinality?f:f[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",
dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",
longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},shortDateLE:{datePattern:"d/M/y",selector:"date"},
shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",timePattern:"h:mm a",selector:"date and time"},
longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",
timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",
timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(a,e){var p=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,f,c){a=p._getLayerFieldInfo(e,c);return"$"+(a?
"{"+a.name+"}":f)})},_encodeAttributes:function(a){a=m.clone(a)||{};var e,p;for(e in a)(p=a[e])&&"string"===typeof p&&(p=encodeURIComponent(p).replace(/\'/g,"\x26apos;"),a[e]=p);return a},_processFieldsInLinks:function(a,e){var p=this._encodeAttributes(e);e=m.hitch(this,this._addValuesToHref,e,p);a&&(a=a.replace(this._reHref,e).replace(this._reHrefApos,e));return a},_addValuesToHref:function(a,e,p,l){l=l&&m.trim(l);return p=u.substitute(l&&0===l.indexOf("${")?a:e,p)},_getLayerFieldInfo:function(a,
e){return a&&a.getField?a.getField(e):null},_formatValue:function(a,e,p,l){var f=this._fieldsMap[e.toLowerCase()],c=f&&f.format;e=-1!==d.indexOf(p.dateFormat.properties,e);var k="number"===typeof a&&!e&&(!c||!c.dateFormat);if(!u.isDefined(a)||!f||!u.isDefined(c))return this._applyFormatting(a,k);var b,f=c.hasOwnProperty("places")||c.hasOwnProperty("digitSeparator"),v=c.hasOwnProperty("digitSeparator")?c.digitSeparator:!0;if(f&&!e)b={formatType:"NumberFormat",places:u.isDefined(c.places)&&(!l||0<c.places)?
Number(c.places):Infinity};else if(c.dateFormat)b=m.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},this._dateFormatsJson[c.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(a,k);var h=this._applyFormatFunctions(a,b,p);f&&-1<a.constructor.toString().indexOf("Array")&&(h="",d.forEach(a,m.hitch(this,function(a,l){l&&(h+=" ");h+=this._applyFormatFunctions(a,b,p)})));f&&!v&&w.group&&(h=h.replace(new RegExp("\\"+w.group,"g"),""));e&&(h='\x3cspan class\x3d"esriDateValue"\x3e'+
h+"\x3c/span\x3e");return this._applyFormatting(h,k)},_applyFormatFunctions:function(a,e,c){e&&c&&(c.format={myKey:e});a=u.substitute({myKey:a},"${myKey}",c)||"";e&&c&&(c.format=null);return a},_applyFormatting:function(a,e){return e?this._forceLTR(a):this._applyPreWrap(a)},_forceLTR:function(a){var e=z("ie");return e&&10>=e?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_applyPreWrap:function(a){return"string"===typeof a?a.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):
a},_insertOffset:function(a){a&&(a=u.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,e,c,l){return(a=a.getDomain&&a.getDomain(c,{feature:e}))&&a.codedValues?a.getName(l):null},_getTypeName:function(a,e,c){return(a=a.getType&&a.getType(e))&&a.name},_getRelatedRecords:function(a){var e=a.graphic,c;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=this._getRelatedLayersInfo(a).then(m.hitch(this,function(a){for(c in a)a.hasOwnProperty(c)&&
a[c]&&(this._relatedLayersInfo[c].relatedLayerInfo=a[c])})));return this._relatedLayersInfoPromise.then(m.hitch(this,function(){return this._queryRelatedLayers(e)})).then(m.hitch(this,function(a){this._setRelatedRecords(e,a);return a}))},_getRelatedLayersInfo:function(a){var e=a.fieldsInfo,p,l,f={};p=a.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});d.forEach(e,function(a){var l,f,e,k;l=this._fromRelatedFieldName(a.fieldName);f=l[0];l=l[1];f&&(!this._relatedLayersInfo[f]&&
p&&p.relationships&&(d.some(p.relationships,function(a){if(a.id==f)return k=a,!0}),k&&(this._relatedLayersInfo[f]={relation:k,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[f]&&(this._relatedLayersInfo[f].relatedFields.push(l),a.statisticType&&(e=new c,e.statisticType=a.statisticType,e.onStatisticField=l,e.outStatisticFieldName=l,this._relatedLayersInfo[f].outStatistics.push(e))))},this);for(l in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(l)&&this._relatedLayersInfo[l]&&
(a=this._relatedLayersInfo[l].relation,a=p.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[l].relatedLayerUrl=a,f[l]=y({url:a,content:{f:"json"},callbackParamName:"callback"}));return n(f)},_queryRelatedLayers:function(a){var e={},c;for(c in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(c)&&(e[c]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[c]}));return n(e)},_queryRelatedLayer:function(a){var e,c,l,f,k,b,v,h,w,x,g,y,u;e=a.graphic;c=e.getSourceLayer();
l=c.url.match(/[0-9]+$/g)[0];g=a.relatedInfo;x=g.relatedLayerInfo;y=g.relatedLayerUrl;a=g.relation;d.some(x.relationships,function(a){if(a.relatedTableId===parseInt(l,10))return f=a,!0},this);f&&(k=new B,d.some(x.fields,function(a){if(a.name===f.keyField)return h=-1!==d.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),f.relationshipTableId&&f.keyFieldInRelationshipTable?(u=new q,this._queryRelatedRecords(e,f).then(m.hitch(this,
function(a){var l;(l=a[e.attributes[c.objectIdField]])?(a=d.map(l.features,function(a){return a.attributes[x.objectIdField]},this),g.outStatistics&&0<g.outStatistics.length&&x.supportsStatistics&&(w=new B,w.where=this._chunkWhereInClause(x.objectIdField,a,1E3),w.outFields=k.outFields,w.outStatistics=g.outStatistics),w&&(b=new G(y),b.execute(w).then(m.hitch(this,function(a){var f=[];f.push(l);f.push(a);u.resolve(f)})))):u.resolve()}))):(v="string"===h?f.keyField+"\x3d'"+e.attributes[a.keyField]+"'":
f.keyField+"\x3d"+e.attributes[a.keyField],k.where=v,k.outFields=g.relatedFields,g.outStatistics&&0<g.outStatistics.length&&x.supportsStatistics&&(w=new B,w.where=k.where,w.outFields=k.outFields,w.outStatistics=g.outStatistics),b=new G(y),v=[],v.push(b.execute(k)),w&&v.push(b.execute(w))));return v?n(v):u?u.promise:void 0},_setRelatedRecords:function(a,e){this._relatedInfo=[];for(var c in e)e.hasOwnProperty(c)&&e[c]&&(a=e[c],this._relatedInfo[c]={},this._relatedInfo[c].relatedFeatures=a[0].features,
u.isDefined(a[1])&&(this._relatedInfo[c].relatedStatsFeatures=a[1].features))},_handlerErrorResponse:function(a,e){a.reject(e)},_fromRelatedFieldName:function(a){var e=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),e=a.slice(1));return e},_toRelatedFieldName:function(a){var e="";a&&0<a.length&&(e=this._relatedFieldPrefix+a[0]+"/"+a[1]);return e},_queryRelatedRecords:function(a,e){var c=a.getSourceLayer(),l=new k;l.outFields=["*"];l.relationshipId=e.id;l.objectIds=[a.attributes[c.objectIdField]];
return c.queryRelatedFeatures(l)},_removeEmptyHref:function(a){return a.replace(/href=(""|'')/gi,"")},_chunkWhereInClause:function(a,e,c){for(var l=0,f=[];l<e.length;)f.push(a+" IN ("+e.slice(l,c+l)+")"),l+=c;return f.join(" OR ")}});b("extend-esri")&&(D.PopupInfo=D.PopupInfoTemplate=r);return r})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(r){var m=r.getObject("dojox.html.entities",!0),d=function(g,b){var q,d;if(b._encCache&&b._encCache.regexp&&b._encCache.mapper&&b.length==
b._encCache.length)q=b._encCache.mapper,d=b._encCache.regexp;else{q={};d=["["];var n;for(n=0;n<b.length;n++)q[b[n][0]]="\x26"+b[n][1]+";",d.push(b[n][0]);d.push("]");d=new RegExp(d.join(""),"g");b._encCache={mapper:q,regexp:d,length:b.length}}return g=g.replace(d,function(b){return q[b]})},t=function(g,b){var q,d;if(b._decCache&&b._decCache.regexp&&b._decCache.mapper&&b.length==b._decCache.length)q=b._decCache.mapper,d=b._decCache.regexp;else{q={};d=["("];var n;for(n=0;n<b.length;n++){var h="\x26"+
b[n][1]+";";n&&d.push("|");q[h]=b[n][0];d.push(h)}d.push(")");d=new RegExp(d.join(""),"g");b._decCache={mapper:q,regexp:d,length:b.length}}return g=g.replace(d,function(b){return q[b]})};m.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];m.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac",
"not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7",
"Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1",
"aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb",
"ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],
["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1",
"thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203",
"exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],
["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],
["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];m.encode=function(g,b){g&&(b?g=d(g,b):(g=d(g,m.html),g=d(g,m.latin)));return g};m.decode=function(d,b){d&&(b?d=t(d,b):(d=t(d,m.html),d=t(d,m.latin)));return d};
return m})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(r,m,d,t,g,b){r=r(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(b){m.mixin(this,b);this.returnType=this.returnType||"string";this.id=g.getAttributeId(this.expression);
this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var d=this._traits.geometryOperations;void 0===d&&(d=this._traits.geometryOperations=b.hasGeometryOperations(this.syntaxTree));return d},hasFeatureSetOperations:function(){var d=this._traits.featureSetOperations;void 0===d&&(d=this._traits.featureSetOperations=b.hasFeatureSetOperations(this.syntaxTree));return d},hasVariable:function(d){var g=this._traits.variables;void 0===
g[d]&&(g[d]=b.hasVariable(this.syntaxTree,d));return g[d]},hasFunction:function(d){var g=this._traits.functions;void 0===g[d]&&(g[d]=b.hasFunction(this.syntaxTree,d));return g[d]},evaluate:function(d){this._compile();var g=this._attributeCache.compiledFunc;return this.async?b.executeAsyncFunction(g,d):b.executeFunction(g,d)},_setSyntaxTree:function(b){this.syntaxTree=b;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef=
{valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});d("extend-esri")&&(t.ArcadeExpression=r);return r})},
"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(r,m,d,t,g,b,q,z,n,h,u,D,y,A,C){var B=n("esri-pbf"),G=m(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(c){this._handleSuccess=
d.hitch(this,this._handleSuccess);this._handleError=d.hitch(this,this._handleError);d.mixin(this,c);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var c=new g(this._canceler);this._fetchDfd=c;this._result=null;this._sendRequest();return c.promise},_canceler:function(c){var k=c._pendingRequest,b;c.isFulfilled()||!k||k.isFulfilled()||(k.cancel(),b=k.results&&k.results[1]);c._pendingRequest=null;return b},_sendRequest:function(c){var k=this.query;
this.pagination&&(this._startPage=k.resultOffset=null==c?0:c,k.resultRecordCount=this.pageSize);c=this.requestOptions;this._fetchDfd._pendingRequest=h({url:this.url,content:k,handleAs:"pbf"===k.f?"arraybuffer":"json",callbackParamName:"callback",timeout:c&&c.timeout},c);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},_handleSuccess:function(c){this.pagination?(c.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=
this._result.features.concat(c.features):this._result=c,this._fetchDfd.progress(c),c.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(c),this._fetchDfd.resolve(c))},_handleError:function(c){this._fetchDfd.reject(c)}}),k=m(A,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(c,k){this._handler=
d.hitch(this,this._handler);this._relationshipQueryHandler=d.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=d.hitch(this,this._executeForIdsHandler);this._countHandler=d.hitch(this,this._countHandler);this._extentHandler=d.hitch(this,this._extentHandler);this.source=k&&k.source;this.gdbVersion=k&&k.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,
p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(c,v,n,w,a){var e=a.assembly;c=this._encode(d.mixin({},this._url.query,{f:w&&w.format||"json"},c.toJson(e&&e[0])));var p=this._handler,
l=this._errorHandler;this.source&&(w={source:this.source.toJson()},c.layer=b.toJson(w));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var f="pbf"===c.f;if(f){var E;B||(E="QueryTask.execute: 'pbf' format is not supported in your browser.");if(E)return c=new g,c.addErrback(function(f){l(f,n,a.dfd)}),c.reject(Error(E)),c}E=this.requestOptions;E=h({url:this._url.path+"/query",content:c,callbackParamName:"callback",handleAs:f?"arraybuffer":"json",timeout:E&&E.timeout},E);c=[E];f&&c.push(k.loadPBFReader());
(new q(c)).then(function(c){a.dfd.isFulfilled()||(c=c[0],c[0]?p(c[1],f,v,n,a.dfd):l(c[1],n,a.dfd))});return E},rawExecute:function(c,k,h){k=k||{};c=this._encode(d.mixin({},this._url.query,{f:k.format||"json"},c.toJson(h.assembly&&h.assembly[0])));this.source&&(c.layer=b.toJson({source:this.source.toJson()}));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);return(new G({url:this._url.path+"/query",query:c,requestOptions:this.requestOptions,pagination:k.pagination,pageSize:k.pageSize})).execute().then(null,
null,function(c){h.dfd.progress(c)}).then(d.hitch(this,function(c){this._successHandler([c],"onRawExecuteComplete",null,h.dfd)})).otherwise(d.hitch(this,function(c){this._errorHandler(c,null,h.dfd)}))},executeRelationshipQuery:function(c,k,b){c=this._encode(d.mixin({},this._url.query,{f:"json"},c.toJson()));var n=this._relationshipQueryHandler,a=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var e=new g(u._dfdCanceller),p=this.requestOptions,l=this._url.path;this.source&&void 0!==
this.source.mapLayerId&&null!==this.source.mapLayerId&&l.endsWith("/dynamicLayer")&&(l=l.slice(0,-13),l=l+"/"+this.source.mapLayerId);e._pendingDfd=h({url:l+"/queryRelatedRecords",content:c,callbackParamName:"callback",timeout:p&&p.timeout,load:function(a,l){n(a,l,k,b,e)},error:function(l){a(l,b,e)}},p);return e},executeForIds:function(c,k,n,w){var a=w.assembly;c=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},c.toJson(a&&a[0])));var e=this._executeForIdsHandler,p=this._errorHandler;
this.source&&(a={source:this.source.toJson()},c.layer=b.toJson(a));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);a=this.requestOptions;return h({url:this._url.path+"/query",content:c,callbackParamName:"callback",timeout:a&&a.timeout,load:function(a,f){e(a,f,k,n,w.dfd)},error:function(a){p(a,n,w.dfd)}},a)},executeForCount:function(c,k,n,w){var a=w.assembly;c=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},c.toJson(a&&a[0])));var e=this._countHandler,p=this._errorHandler;
this.source&&(a={source:this.source.toJson()},c.layer=b.toJson(a));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);a=this.requestOptions;return h({url:this._url.path+"/query",content:c,callbackParamName:"callback",timeout:a&&a.timeout,load:function(a,f){e(a,f,k,n,w.dfd)},error:function(a){p(a,n,w.dfd)}},a)},executeForExtent:function(c,k,n,w){var a=w.assembly;c=this._encode(d.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},c.toJson(a&&a[0])));var e=this._extentHandler,p=
this._errorHandler;this.source&&(a={source:this.source.toJson()},c.layer=b.toJson(a));this.gdbVersion&&(c.gdbVersion=this.gdbVersion);a=this.requestOptions;return h({url:this._url.path+"/query",content:c,callbackParamName:"callback",timeout:a&&a.timeout,load:function(a,f){e(a,f,k,n,w.dfd)},error:function(a){p(a,n,w.dfd)}},a)},_handler:function(c,b,h,d,a){try{c&&b&&(c=k.pbfDeps.optimizedFeatures.convertToFeatureSet(k.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(c)));var e=new C(c);this._successHandler([e],
"onComplete",h,a)}catch(p){this._errorHandler(p,d,a)}},_relationshipQueryHandler:function(c,k,b,h,a){try{var e=c.geometryType,p=c.spatialReference,l={};t.forEach(c.relatedRecordGroups,function(a){var f={};f.geometryType=e;f.spatialReference=p;f.features=a.relatedRecords;f=new C(f);if(null!=a.objectId)l[a.objectId]=f;else for(var c in a)a.hasOwnProperty(c)&&"relatedRecords"!==c&&(l[a[c]]=f)});this._successHandler([l],"onExecuteRelationshipQueryComplete",b,a)}catch(f){this._errorHandler(f,h,a)}},_executeForIdsHandler:function(c,
k,b,h,a){try{this._successHandler([c.objectIds],"onExecuteForIdsComplete",b,a)}catch(e){this._errorHandler(e,h,a)}},_countHandler:function(c,k,b,h,a){try{var e,p=c.features,l=c.objectIds;if(l)e=l.length;else{if(p)throw Error("Unable to perform query. Please check your parameters.");e=c.count}this._successHandler([e],"onExecuteForCountComplete",b,a)}catch(f){this._errorHandler(f,h,a)}},_extentHandler:function(c,k,b,h,a){try{c.extent&&(c.extent=new D(c.extent)),this._successHandler([c],"onExecuteForExtentComplete",
b,a)}catch(e){this._errorHandler(e,h,a)}}});k.loadPBFReader=function(){var c=new g;k.pbfDeps?c.resolve():r(["./support/pbfDeps"],function(b){k.pbfDeps=b;c.isFulfilled()||c.resolve()});return c.promise};y._createWrappers(k);n("extend-esri")&&d.setObject("tasks.QueryTask",k,z);return k})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(r,m,d){r.DeferredList=function(t,g,b,q,r){var n=[];m.call(this);var h=this;0!==t.length||g||this.resolve([0,[]]);
var u=0;d.forEach(t,function(d,y){function m(b,d){n[y]=[b,d];u++;u===t.length&&h.resolve(n)}d.then(function(b){g?h.resolve([y,b]):m(!0,b)},function(d){b?h.reject(d):m(!1,d);if(q)return null;throw d;})})};r.DeferredList.prototype=new m;r.DeferredList.prototype.gatherResults=function(m){m=new r.DeferredList(m,!1,!0,!1);m.addCallback(function(g){var b=[];d.forEach(g,function(d){b.push(d[1])});return b});return m};return r.DeferredList})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(r,m,d,t,g,b,q,z){r=r(z,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(b,h){b&&m.isString(b)&&(this._url=q.urlToObject(this.url=b));h&&h.requestOptions&&(this.requestOptions=h.requestOptions);this.normalization=!0;this._errorHandler=m.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var b=this._url,h=/^http:/i;this.url&&(this.url=this.url.replace(h,"https:"));b&&b.path&&(b.path=b.path.replace(h,"https:"))},
_encode:function(b,h,g){var n,y,u={},q,t;for(q in b)if("declaredClass"!==q&&(n=b[q],y=typeof n,null!==n&&void 0!==n&&"function"!==y))if(m.isArray(n))for(u[q]=[],t=n.length,y=0;y<t;y++)u[q][y]=this._encode(n[y]);else"object"===y?n.toJson&&(y=n.toJson(g&&g[q]),"esri.tasks.FeatureSet"===n.declaredClass&&y.spatialReference&&(y.sr=y.spatialReference,delete y.spatialReference),u[q]=h?y:d.toJson(y)):u[q]=n;return u},_successHandler:function(d,h,g,m){h&&this[h].apply(this,d);g&&g.apply(null,d);m&&b._resDfd(m,
d)},_errorHandler:function(b,d,g){this.onError(b);d&&d(b);g&&g.errback(b)},setNormalization:function(b){this.normalization=b},onError:function(){}});t("extend-esri")&&(g.Task=r);return r})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(r,m,d,t,g,b,q,z,n,h,u,D){r=r(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(b,h){if(b){m.mixin(this,b);var n=this.features=this.features||[],g=b.spatialReference,g=this.spatialReference=u.createInstance(z.simpleConstructor,g),y=u.getGeometryType(b.geometryType);this.geometryType=b.geometryType;b.fields&&(this.fields=b.fields);b=u.supportsLazyUnquantization(this.geometryType);var k=u.unquantizeFunction(this.geometryType,this.transform),c=!!(h&&b&&k),v=y&&(c?y.accessorConstructor:y.simpleConstructor);d.forEach(n,function(b,d){var a=u.createInstance(q.simpleConstructor),
e=b.geometry;if(y&&e){var p=a.geometry=u.createInstance(v,c?null:e);p.setSpatialReference(e.spatialReference?u.createInstance(z.simpleConstructor,e.spatialReference):g);c&&p.setupLazyUnquantization(k,e)}a.symbol=b.symbol?D.fromJson(b.symbol):null;a.attributes=b.attributes;n[d]=a});c||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(d){var h={};this.displayFieldName&&(h.displayFieldName=this.displayFieldName);this.fields&&
(h.fields=this.fields);this.spatialReference?h.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(h.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(h.geometryType=u.getJsonType(this.features[0].geometry)),h.features=n._encodeGraphics(this.features,d));h.geometryType=h.geometryType||this.geometryType;h.exceededTransferLimit=this.exceededTransferLimit;h.transform=this.transform;return b.fixJson(h)},
_hydrate:function(){u.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(b){if(!this.geometryType)return this.transform=null,this;var h=b.translate[0],d=b.translate[1],n=b.scale[0],g=b.scale[1],k=this.features,c=function(a,c,k){var l,f,e,b,p,h,d=[];l=0;for(f=a.length;l<f;l++)if(e=a[l],0<l){if(h=c(e[0]),e=k(e[1]),h!==b||e!==p)d.push([h-b,e-p]),b=h,p=e}else b=c(e[0]),p=k(e[1]),d.push([b,p]);return 0<d.length?d:null},v=function(a,e,k){if("esriGeometryPoint"===
a)return function(a){a.x=e(a.x);a.y=k(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var f,l,b,p,h;b=a.rings||a.paths;h=[];f=0;for(l=b.length;f<l;f++)p=b[f],(p=c(p,e,k))&&h.push(p);return 0<h.length?(a.rings?a.rings=h:a.paths=h,a):null};if("esriGeometryMultipoint"===a)return function(a){var f;f=c(a.points,e,k);return 0<f.length?(a.points=f,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-
h)/n)},function(a){return Math.round((d-a)/g)}),m,w;m=0;for(w=k.length;m<w;m++)k[m].geometry&&(v(k[m].geometry)||k[m].setGeometry(null));this.transform=b;return this}});r.createGraphics=function(b){var h=b.geometryType,n=u.createInstance(z.simpleConstructor,b.spatialReference),g=u.getGeometryType(h).accessorConstructor,m=u.unquantizeFunction(h,b.transform);return d.map(b.features,function(b,c){c=u.createInstance(q.simpleConstructor);var k=b.geometry;if(k){var h=c.geometry=u.createInstance(g);h.setSpatialReference(n);
h.setupLazyUnquantization(m,k)}c.attributes=b.attributes;return c})};r.createPolygon=function(b,d,n){var g;b&&(g=u.createInstance(h.accessorConstructor),g.setSpatialReference(d),d=u.unquantizeFunction("esriGeometryPolygon",n),g.setupLazyUnquantization(d,b));return g};t("extend-esri")&&m.setObject("tasks.FeatureSet",r,g);return r})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(r,m,d,t,g){r=r(null,{declaredClass:"esri.tasks.RelationshipQuery",
definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var b={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},g=this.objectIds,m=this.outFields,n=this.outSpatialReference,h=this.orderByFields;g&&(b.objectIds=g.join(","));m&&(b.outFields=m.join(","));
n&&(b.outSR=n.wkid||d.toJson(n.toJson()));h&&(b.orderByFields=h.join(","));b._ts=this._ts;return b}});t("extend-esri")&&m.setObject("tasks.RelationshipQuery",r,g);return r})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(r,m,d,t){r=r(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,
maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});d("extend-esri")&&m.setObject("tasks.StatisticDefinition",r,t);return r})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(r,m,d,t,g,b,q,z){r=new (r(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore",
"$map"],async:["$layer","$datastore","$map"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any",$map:"any"}}},initialize:function(b){var h=[];z.hasGeometryOperations(b)&&h.push(q.enableGeometryOperations());(z.hasFeatureSetOperations(b)||z.hasVariables(b,this.defaults.globals.featureSet))&&h.push(q.enableFeatureSetOperations());z.isAsync(b)&&h.push(q.enableAsyncOperations());return g(h)},isAsync:function(b){b=[b];return z.hasFeatureSetOperations(b)||z.hasVariables(b,this.defaults.globals.async)},
parse:function(b){return q.createSyntaxTree(b.expression)},compile:function(b){var h=m.clone(this.defaults.context);h.useAsync=b.async;return b.syntaxTree?q.createFunction(b.syntaxTree,h):null},getEvalOptions:function(d){var h=d.expression,g=d.feature,n=d.layer,m=d.map;d=d.spatialReference;var g=g&&h.hasVariable("$feature")?b.createFromGraphicLikeObject(g.geometry,g.attributes,n):null,t,r;if(n){var B={spatialReference:d};h.hasVariable("$layer")&&(t=n.getMap()?q.createFeatureSetFromLayer(n,B):q.createFeatureSetFromLayerUrl(n.url,
B));h.hasVariable("$datastore")&&(r=(r=z.getServiceUrl(n.url))?q.createFeatureSetCollectionFromServiceUrl(r,B):null)}h=m&&h.hasVariable("$map")?q.createFeatureSetCollectionFromMap(m):null;return{context:{vars:{$feature:g,$layer:t,$datastore:r,$map:h},spatialReference:d}}}}));d("extend-esri")&&m.setObject("arcadeProfiles.popupProfile",r,t);return r})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(r,m,d,t,g,b,q,z,n,h,u,D,y,A,C,B,G,k,c,v,x){var w=0,a=x.widgets.popup,e=x.widgets.templatePicker;m=m([v,C,B],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=t.mixin({},a)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'statusSection hidden' dojoAttachPoint\x3d'_status'\x3e\x3c/div\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this._showStatus(e.loading);this._contentDfd=this.template.getComponents(this.graphic).then(t.hitch(this,this._handleComponentsSuccess)).otherwise(t.hitch(this,this._handleComponentsError))},destroy:function(){this._contentDfd&&this._contentDfd.cancel();this._attachmentsDfd&&this._attachmentsDfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._contentDfd=this._attachmentsDfd=null;this.inherited(arguments)},
_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,l=a.length,f=this.domNode,c=this._prevMedia,e=this._nextMedia;if(1<l){var k=0,d=0;g.forEach(a,function(a){"image"===a.type?k++:-1!==a.type.indexOf("chart")&&d++});k&&(h.set(this._imageCount,"innerHTML",k),b.query(".summary .image",
f).removeClass("hidden"));d&&(h.set(this._chartCount,"innerHTML",d),b.query(".summary .chart",f).removeClass("hidden"))}else b.query(".summary",f).addClass("hidden"),u.add(c,"hidden"),u.add(e,"hidden");a=this._mediaPtr;0===a?u.add(c,"hidden"):u.remove(c,"hidden");a===l-1?u.add(e,"hidden"):u.remove(e,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],l=a.title,f=a.caption,c=b.query(".mediaSection .hzLine",this.domNode)[0];h.set(this._mediaTitle,"innerHTML",
l);u[l?"remove":"add"](this._mediaTitle,"hidden");h.set(this._mediaCaption,"innerHTML",f);u[f?"remove":"add"](this._mediaCaption,"hidden");u[l&&f?"remove":"add"](c,"hidden");this._rid=null;if("image"===a.type)this._showImage(a);else{var e=this,l=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],f=a.value.theme||this.chartTheme;t.isString(f)&&(f=f.replace(/\./gi,"/"),-1===f.indexOf("/")&&(f="dojox/charting/themes/"+f));f||(f="./Rainbow");l.push(f);try{var k=this._rid=w++;r(l,function(f,
l,c){k===e._rid&&(e._rid=null,e._showChart(a.type,a.value,f,l,c))})}catch(N){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=a&&t.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){u.add(this._mediaFrame,"image");var l=y.get(this._gallery,"height"),f=a.value,c;f.linkURL&&(c=D.create("a",{href:f.linkURL,target:this._preventNewTab(f.linkURL)?"":"_blank"},this._mediaFrame));f=a.refreshInterval?this._addURLParameter(f.sourceURL,
"timestamp",Date.now()):f.sourceURL;D.create("img",{className:"esriPopupMediaImage",src:f},c||this._mediaFrame);var e=b.query(".esriPopupMediaImage",this._mediaFrame)[0];this._imageLoadHandle=d.connect(e,"onload",this,function(){this._clearImageHandles();this._imageLoaded(e,l);this._initImageRefresh(a)})},_addURLParameter:function(a,l,f){var c=-1===a.indexOf("?")?"?":"\x26";return a+c+l+"\x3d"+f},_initImageRefresh:function(a){if(a.refreshInterval){var l=6E4*a.refreshInterval;this._imageRefreshHandle=
setTimeout(t.hitch(this,function(){this._destroyFrame();this._showImage(a)}),l)}},_clearImageHandles:function(){d.disconnect(this._imageLoadHandle);this._imageLoadHandle=null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(a,l,f,c,e){u.remove(this._mediaFrame,"image");f=this._chart=new f(D.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});e&&f.setTheme(e);switch(a){case "piechart":f.addPlot("default",{type:"Pie",labels:!1});f.addSeries("Series A",
l.fields);break;case "linechart":f.addPlot("default",{type:"Markers"});f.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});f.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});g.forEach(l.fields,function(a,f){a.x=f+1});f.addSeries("Series A",l.fields);break;case "columnchart":f.addPlot("default",{type:"Columns",gap:3});f.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});f.addSeries("Series A",l.fields);break;case "barchart":f.addPlot("default",{type:"Bars",
gap:3}),f.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),f.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),f.addSeries("Series A",l.fields)}this._action=new c(f);f.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);h.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,l){var f=a.height;f<l&&y.set(a,"marginTop",
Math.round((l-f)/2)+"px")},_attListHandler:function(a,l){if(a===this._attachmentsDfd){this._attachmentsDfd=null;var f="";l instanceof Error||!l||!l.length||g.forEach(l,function(a){f+="\x3cli\x3e";f+="\x3ca href\x3d'"+c.addProxy(a.url)+"' target\x3d'_blank'\x3e"+(a.name||"[No name]")+"\x3c/a\x3e";f+="\x3c/li\x3e"});h.set(this._attachmentsList,"innerHTML",f||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_supportedURIInfos:[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,label:a.NLS_moreInfo},{pattern:/^\s*(tel:([^\s]+))\s*$/i,
label:"${hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"${hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,appName:"App Studio Player",label:a.NLS_openLinkInApp},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,appName:"Collector",label:a.NLS_openLinkInApp},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,appName:"Explorer",label:a.NLS_openLinkInApp},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,appName:"Navigator",label:a.NLS_openLinkInApp},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,
appName:"Survey123",label:a.NLS_openLinkInApp},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,appName:"Trek2There",label:a.NLS_openLinkInApp},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,appName:"Workforce",label:a.NLS_openLinkInApp},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,appName:"iForm",label:a.NLS_openLinkInApp},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,appName:"FlowFinity",label:a.NLS_openLinkInApp},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,appName:"Laserfische",label:a.NLS_openLinkInApp},
{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,appName:"Microsoft Power BI",label:a.NLS_openLinkInApp}],_findURIInfo:function(a){var l;g.some(this._supportedURIInfos,function(f){f.pattern.test(a)&&(l=f);return!!l});return l},_createLinkIfURI:function(a){var l=this._findURIInfo(a);if(l){var f=a.match(l.pattern);return a.replace(l.pattern,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+k.substitute({appName:l.appName,hierPart:f&&f[2]},l.label)+"\x3c/a\x3e")}return a},_showStatus:function(a){h.set(this._status,
"innerHTML",a);u.remove(this._status,"hidden");b.query(".mainSection",this.domNode).addClass("hidden")},_hideStatus:function(){h.set(this._status,"innerHTML","");u.add(this._status,"hidden");b.query(".mainSection",this.domNode).removeClass("hidden")},_handleComponentsSuccess:function(c){if(c){this._hideStatus();var l=this.showTitle?c.title:"",f=c.description,e=c.fields,k=c.mediaInfos,d=this.domNode,p=this._nls,w=this,v=this.template,m=this.graphic;this._prevMedia.title=p.NLS_prevMedia;this._nextMedia.title=
p.NLS_nextMedia;h.set(this._title,"innerHTML",l);l||u.add(this._title,"hidden");!c.hasDescription&&e&&(f="",g.forEach(e,function(a){f+="\x3ctr valign\x3d'top'\x3e";f+="\x3ctd class\x3d'attrName'\x3e"+A.encode(a[0])+"\x3c/td\x3e";f+="\x3ctd class\x3d'attrValue'\x3e"+this._createLinkIfURI(a[1])+"\x3c/td\x3e";f+="\x3c/tr\x3e"},this),f&&(f="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+f+"\x3c/table\x3e"));h.set(this._description,"innerHTML",f);f||u.add(this._description,
"hidden");b.query("a",this._description).forEach(function(a){w._preventNewTab(a.href)?"_blank"===a.target&&h.remove(a,"target"):h.set(a,"target","_blank")});l&&f?b.query(".mainSection .hzLine",d).removeClass("hidden"):l||f?b.query(".mainSection .hzLine",d).addClass("hidden"):b.query(".mainSection",d).addClass("hidden");if(l=this._attachmentsDfd=v.getAttachments(m))l.addBoth(t.hitch(this,this._attListHandler,l)),h.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+p.NLS_searching+"...\x3c/li\x3e"),
b.query(".attachmentsSection",d).removeClass("hidden");k&&k.length&&(b.query(".mediaSection",d).removeClass("hidden"),n.setSelectable(this._mediaFrame,!1),this._mediaInfos=k,this._mediaPtr=0,this._updateUI(),this._displayMedia());c.editSummary&&(h.set(this._editSummary,"innerHTML",c.editSummary),k&&k.length&&u.remove(this._mediaBreak,"hidden"),u.remove(this._editSummarySection,"hidden"));this.emit("content-update")}else this._showStatus(a.NLS_noInfo)},_handleComponentsError:function(c){c&&"cancel"===
c.dojoType||(console.log("PopupRenderer: error loading template",c),this._showStatus(a.NLS_noInfo))}});q("extend-esri")&&t.setObject("dijit._PopupRenderer",m,G);return m})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(r,m,d,t,g,b,q,z,n,h,u,D,y){function A(){}function C(b){return function(h,
k,c,g){return h&&"string"==typeof k&&h[k]==A?h.on(k.substring(2).toLowerCase(),q.hitch(c,g)):b.apply(d,arguments)}}r.around(d,"connect",C);b.connect&&r.around(b,"connect",C);r=t("dijit._Widget",[u,D,y],{onClick:A,onDblClick:A,onKeyDown:A,onKeyPress:A,onKeyUp:A,onMouseDown:A,onMouseMove:A,onMouseOut:A,onMouseOver:A,onMouseLeave:A,onMouseEnter:A,onMouseUp:A,constructor:function(b){this._toConnect={};for(var d in b)this[d]===A&&(this._toConnect[d.replace(/^on/,"").toLowerCase()]=b[d],delete b[d])},postCreate:function(){this.inherited(arguments);
for(var b in this._toConnect)this.on(b,this._toConnect[b]);delete this._toConnect},on:function(b,h){return this[this._onMap(b)]===A?d.connect(this.domNode,b.toLowerCase(),this,h):this.inherited(arguments)},_setFocusedAttr:function(b){this._focused=b;this._set("focused",b)},setAttribute:function(d,h){b.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(d,h)},attr:function(b,d){return 2<=arguments.length||"object"===typeof b?this.set.apply(this,
arguments):this.get(b)},getDescendants:function(){b.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?z("[widgetId]",this.containerNode).map(h.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});g("dijit-legacy-requires")&&n(0,function(){require(["dijit/_base"])});return r})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(r,m,d,t,g,b,q,z,n,h,u,D,y,A,C,B,G,k,c,v,x,w,a){function e(a){return function(f){z[f?"set":"remove"](this.domNode,a,f);this._set(a,f)}}y.add("dijit-legacy-requires",!A.isAsync);y.add("dojo-bidi",!1);y("dijit-legacy-requires")&&G(0,function(){r(["dijit/_base/manager"])});var p={};t=b("dijit._WidgetBase",[k,x],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:e("lang"),dir:"",_setDirAttr:e("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:t.blankGif||r.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var f=a.prototype,c=a._setterAttrs=[],a=a._onMap={},e;for(e in f.attributeMap)c.push(e);for(e in f)/^on/.test(e)&&(a[e.substring(2).toLowerCase()]=e),/^_set[A-Z](.*)Attr$/.test(e)&&(e=e.charAt(4).toLowerCase()+
e.substr(5,e.length-9),f.attributeMap&&e in f.attributeMap||c.push(e))}},postscript:function(a,f){this.create(a,f)},create:function(c,f){this._introspect();this.srcNodeRef=q.byId(f);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);c&&(this.params=c,C.mixin(this,c));this.postMixInProperties();this.id||(this.id=a.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=v.body(this.ownerDocument);a.add(this);this.buildRendering();var e;this.domNode&&(this._applyAttributes(),(c=this.srcNodeRef)&&c.parentNode&&this.domNode!==c&&(c.parentNode.replaceChild(this.domNode,c),e=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();e&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},f;for(f in this.params||{})a[f]=this._get(f);m.forEach(this.constructor._setterAttrs,
function(f){if(!(f in a)){var c=this._get(f);c&&this.set(f,c)}},this);for(f in a)this.set(f,a[f])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(m.map(a,function(a){return a+"Rtl"})));n.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,m.forEach(this.getChildren(),function(a){a._started||
a._destroyed||!C.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(c){function f(a){a.destroyRecursive?a.destroyRecursive(c):a.destroy&&a.destroy(c)}this._beingDestroyed=!0;this.uninitialize();m.forEach(this._connects,C.hitch(this,"disconnect"));m.forEach(this._supportingWidgets,f);this.domNode&&m.forEach(a.findWidgets(this.domNode,this.containerNode),f);this.destroyRendering(c);
a.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?z.remove(this.domNode,"widgetId"):h.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||h.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){m.forEach(this.getChildren(),function(f){f.destroyRecursive&&f.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var f=this.domNode;C.isObject(a)?
D.set(f,a):f.style.cssText=f.style.cssText?f.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,f,c){c=3<=arguments.length?c:this.attributeMap[a];m.forEach(C.isArray(c)?c:[c],function(c){var e=this[c.node||c||"domNode"];switch(c.type||"attribute"){case "attribute":C.isFunction(f)&&(f=C.hitch(this,f));c=c.attribute?c.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;e.tagName?z.set(e,c,f):e.set(c,f);break;case "innerText":e.innerHTML="";e.appendChild(this.ownerDocument.createTextNode(f));
break;case "textContent":e.textContent=f;break;case "innerHTML":e.innerHTML=f;break;case "class":n.replace(e,f,this[a]);break;case "toggleClass":n.toggle(e,c.className||a,f)}},this)},get:function(a){var c=this._getAttrNames(a);return this[c.g]?this[c.g]():this._get(a)},set:function(a,c){if("object"===typeof a){for(var f in a)this.set(f,a[f]);return this}f=this._getAttrNames(a);var e=this[f.s];if(C.isFunction(e))var b=e.apply(this,Array.prototype.slice.call(arguments,1));else{var e=this.focusNode&&
!C.isFunction(this.focusNode)?"focusNode":"domNode",k=this[e]&&this[e].tagName,l;if((l=k)&&!(l=p[k])){l=this[e];var d={},h;for(h in l)d[h.toLowerCase()]=!0;l=p[k]=d}h=l;f=a in this.attributeMap?this.attributeMap[a]:f.s in this?this[f.s]:h&&f.l in h&&"function"!=typeof c||/^aria-|^data-|^role$/.test(a)?e:null;null!=f&&this._attrToDom(a,c,f);this._set(a,c)}return b||this},_attrPairNames:{},_getAttrNames:function(a){var c=this._attrPairNames;if(c[a])return c[a];var e=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-
1).toUpperCase()});return c[a]={n:a+"Node",s:"_set"+e+"Attr",g:"_get"+e+"Attr",l:e.toLowerCase()}},_set:function(a,c){var e=this[a];this[a]=c;!this._created||e===c||e!==e&&c!==c||(this._watchCallbacks&&this._watchCallbacks(a,e,c),this.emit("attrmodified-"+a,{detail:{prevValue:e,newValue:c}}))},_get:function(a){return this[a]},emit:function(a,c,e){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var f,b=this["on"+a];b&&
(f=b.apply(this,e?e:[c]));this._started&&!this._beingDestroyed&&B.emit(this.domNode,a.toLowerCase(),c);return f},on:function(a,c){var e=this._onMap(a);return e?d.after(this,e,c,!0):this.own(B(this.domNode,a,c))[0]},_onMap:function(a){var c=this.constructor,e=c._onMap;if(!e){var e=c._onMap={},b;for(b in c.prototype)/^on/.test(b)&&(e[b.replace(/^on/,"").toLowerCase()]=b)}return e["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?a.findWidgets(this.containerNode):[]},getParent:function(){return a.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,c,e){return this.own(g.connect(a,c,this,e))[0]},disconnect:function(a){a.remove()},subscribe:function(a,e){return this.own(c.subscribe(a,C.hitch(this,e)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():u.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=D.get(this.domNode,"display")},placeAt:function(c,e){var f=!c.tagName&&a.byId(c);!f||!f.addChild||e&&"number"!==typeof e?(c=f&&"domNode"in f?f.containerNode&&!/after|before|replace/.test(e||"")?f.containerNode:f.domNode:q.byId(c,this.ownerDocument),h.place(this.domNode,c,e),!this._started&&(this.getParent()||{})._started&&this.startup()):f.addChild(this,e);return this},defer:function(a,c){var e=setTimeout(C.hitch(this,function(){e&&(e=null,this._destroyed||C.hitch(this,a)())}),c||0);return{remove:function(){e&&
(clearTimeout(e),e=null);return null}}}});y("dojo-bidi")&&t.extend(w);return t})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(r,m,d){return d("dijit.Destroyable",null,{destroy:function(d){this._destroyed=!0},own:function(){var d=["destroyRecursive","destroy","remove"];r.forEach(arguments,function(g){function b(){t.remove();r.forEach(n,function(b){b.remove()})}var q,t=m.before(this,"destroy",function(b){g[q](b)}),n=[];g.then?(q="cancel",g.then(b,
b)):r.forEach(d,function(d){"function"===typeof g[d]&&(q||(q=d),n.push(m.after(g,d,b,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(r,m,d,t,g,b){r=t("dijit._OnDijitClickMixin",null,{connect:function(d,g,n){return this.inherited(arguments,[d,"ondijitclick"==g?b:g,n])}});r.a11yclick=b;return r})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare",
"dojo/_base/lang"],function(r,m,d,t){t.extend(m,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return d("dijit._FocusMixin",null,{_focusManager:r})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(r,m,d,t){d(function(){m("highcontrast")&&r.add(t.body(),"dijit_a11y")});return m})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(r,m,d,t,g,b,q){g.add("highcontrast",function(){var b=q.doc.createElement("div");try{b.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(m.blankGif||r.toUrl("./resources/blank.gif"))+'");';q.body().appendChild(b);var d=t.getComputedStyle(b),h=d.backgroundImage;return d.borderTopColor==d.borderRightColor||h&&("none"==h||"url(invalid-url:)"==h)}catch(u){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
u.toString()),!1}finally{8>=g("ie")?b.outerHTML="":q.body().removeChild(b)}});b(function(){g("highcontrast")&&d.add(q.body(),"dj_a11y")});return g})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(r,m,d,t,g,b,q){b.extend(r,{waiRole:"",waiState:""});return g("dijit._Templated",[m,d],{constructor:function(){q.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(b,d){var h=this.inherited(arguments),g=d(b,"waiRole");g&&b.setAttribute("role",g);(g=d(b,"waiState"))&&t.forEach(g.split(/\s*,\s*/),function(d){-1!=d.indexOf("-")&&(d=d.split("-"),b.setAttribute("aria-"+d[0],d[1]))});return h}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(r,m,d,t,g,b,q,z){var n=m("dijit._TemplatedMixin",z,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(b){var d=this.declaredClass,h=this;return q.substitute(b,this,function(b,g){"!"==g.charAt(0)&&(b=t.getObject(g.substr(1),!1,h));if("undefined"==typeof b)throw Error(d+" template:"+g);return null==b?"":"!"==g.charAt(0)?b:this._escapeValue(""+b)},this)},_escapeValue:function(b){return b.replace(/["'<>&]/g,function(b){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[b]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=r(this.templatePath,{sanitize:!0}));var b=n.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),g;if(t.isString(b)){if(g=d.toDom(this._stringRepl(b),this.ownerDocument),1!=g.nodeType)throw Error("Invalid template: "+b);}else g=b.cloneNode(!0);this.domNode=g}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(b){var d=this.containerNode;if(b&&d)for(;b.hasChildNodes();)d.appendChild(b.firstChild)}});
n._templateCache={};n.getCachedTemplate=function(b,g,m){var h=n._templateCache,t=b,r=h[t];if(r){try{if(!r.ownerDocument||r.ownerDocument==(m||document))return r}catch(B){}d.destroy(r)}b=q.trim(b);if(g||b.match(/\$\{([^\}]+)\}/g))return h[t]=b;g=d.toDom(b,m);if(1!=g.nodeType)throw Error("Invalid template: "+b);return h[t]=g};b("ie")&&g(window,"unload",function(){var b=n._templateCache,g;for(g in b){var m=b[g];"object"==typeof m&&d.destroy(m);delete b[g]}});return n})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(r){return r.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(r,m,d,t,g,b,q,z,n){var h=g.delegate(z,{mouseenter:b.enter,mouseleave:b.leave,keypress:d._keypress}),u;d=t("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var d=b;;)if(1==d.nodeType&&(this._processTemplateNode(d,function(b,d){return b.getAttribute(d)},this._attach)||this.searchContainerNode)&&d.firstChild)d=d.firstChild;else{if(d==b)break;for(;!d.nextSibling;)if(d=d.parentNode,d==b)return;d=d.nextSibling}},_processTemplateNode:function(b,d,h){var m=!0,n=this.attachScope||this,t=d(b,"dojoAttachPoint")||d(b,"data-dojo-attach-point");if(t)for(var k=t.split(/\s*,\s*/);t=
k.shift();)g.isArray(n[t])?n[t].push(b):n[t]=b,m="containerNode"!=t,this._attachPoints.push(t);if(d=d(b,"dojoAttachEvent")||d(b,"data-dojo-attach-event"))for(t=d.split(/\s*,\s*/),k=g.trim;d=t.shift();)if(d){var c=null;-1!=d.indexOf(":")?(c=d.split(":"),d=k(c[0]),c=k(c[1])):d=k(d);c||(c=d);this._attachEvents.push(h(b,d,g.hitch(n,c)))}return m},_attach:function(b,d,g){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?u||(u=r("./a11yclick")):h[d]||d;return q(b,d,g)},_detachTemplateNodes:function(){var b=
this.attachScope||this;m.forEach(this._attachPoints,function(d){delete b[d]});this._attachPoints=[];m.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});g.extend(n,{dojoAttachEvent:"",dojoAttachPoint:""});return d})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(r,m,d,t,g){return d("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var b=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);g.parse(b,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(t.hitch(this,function(b){this._startupWidgets=b;for(var d=0;d<b.length;d++)this._processTemplateNode(b[d],
function(b,d){return b[d]},function(b,d,g){return d in b?b.connect(b,d,g):b.on(d,g,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(b,d,g){return d(b,"dojoType")||d(b,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){r.forEach(this._startupWidgets,function(b){b&&!b._started&&b.startup&&b.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(r,m,d,t,g,b,q,z,n,h,u,D,y,A,C,B){function G(c){return eval("("+c+")")}function k(c){var a=
c._nameCaseMap,b=c.prototype;if(!a||a._extendCnt<v){var a=c._nameCaseMap={},d;for(d in b)"_"!==d.charAt(0)&&(a[d.toLowerCase()]=d);a._extendCnt=v}return a}function c(c,a){a||(a=r);var b=a._dojoParserCtorMap||(a._dojoParserCtorMap={}),k=c.join();if(!b[k]){for(var l=[],f=0,g=c.length;f<g;f++){var h=c[f];l[l.length]=b[h]=b[h]||d.getObject(h)||~h.indexOf("/")&&a(h)}c=l.shift();b[k]=l.length?c.createSubclass?c.createSubclass(l):c.extend.apply(c,l):c}return b[k]}new Date("X");var v=0;n.after(d,"extend",
function(){v++},!0);var x={_clearCache:function(){v++;_ctorMap={}},_functionFromScript:function(c,a){var b="",d="",k=c.getAttribute(a+"args")||c.getAttribute("args");a=c.getAttribute("with");k=(k||"").split(/\s*,\s*/);a&&a.length&&t.forEach(a.split(/\s*,\s*/),function(a){b+="with("+a+"){";d+="}"});return new Function(k,b+c.innerHTML+d)},instantiate:function(c,a,b){a=a||{};b=b||{};var e=(b.scope||m._scopeName)+"Type",d="data-"+(b.scope||m._scopeName)+"-",f=d+"type",k=d+"mixins",g=[];t.forEach(c,function(c){var b=
e in a?a[e]:c.getAttribute(f)||c.getAttribute(e);if(b){var d=c.getAttribute(k),b=d?[b].concat(d.split(/\s*,\s*/)):[b];g.push({node:c,types:b})}});return this._instantiate(g,a,b)},_instantiate:function(b,a,e,d){function k(c){a._started||e.noStart||t.forEach(c,function(a){"function"!==typeof a.startup||a._started||a.startup()});return c}b=t.map(b,function(b){var f=b.ctor||c(b.types,e.contextRequire);if(!f)throw Error("Unable to resolve constructor for: '"+b.types.join()+"'");return this.construct(f,
b.node,a,e,b.scripts,b.inherited)},this);return d?h(b).then(k):k(b)},construct:function(c,a,b,g,l,f){function e(a){D&&d.setObject(D,a);for(q=0;q<I.length;q++)n[I[q].advice||"after"](a,I[q].method,d.hitch(a,I[q].func),!0);for(q=0;q<L.length;q++)L[q].call(a);for(q=0;q<K.length;q++)a.watch(K[q].prop,K[q].func);for(q=0;q<J.length;q++)C(a,J[q].event,J[q].func);return a}var h=c&&c.prototype;g=g||{};var p={};g.defaults&&d.mixin(p,g.defaults);f&&d.mixin(p,f);var v;y("dom-attributes-explicit")?v=a.attributes:
y("dom-attributes-specified-flag")?v=t.filter(a.attributes,function(a){return a.specified}):(f=(/^input$|^img$/i.test(a.nodeName)?a:a.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),v=t.map(f.split(/\s+/),function(c){var b=c.toLowerCase();return{name:c,value:"LI"==a.nodeName&&"value"==c||"enctype"==b?a.getAttribute(b):a.getAttributeNode(b).value}}));var r=g.scope||m._scopeName;f="data-"+r+"-";var w={};"dojo"!==r&&(w[f+"props"]=
"data-dojo-props",w[f+"type"]="data-dojo-type",w[f+"mixins"]="data-dojo-mixins",w[r+"type"]="dojotype",w[f+"id"]="data-dojo-id");for(var q=0,x,r=[],D,B;x=v[q++];){var F=x.name,H=F.toLowerCase();x=x.value;switch(w[H]||H){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":B=x;break;case "data-dojo-id":case "jsid":D=x;break;case "data-dojo-attach-point":case "dojoattachpoint":p.dojoAttachPoint=x;break;case "data-dojo-attach-event":case "dojoattachevent":p.dojoAttachEvent=
x;break;case "class":p["class"]=a.className;break;case "style":p.style=a.style&&a.style.cssText;break;default:if(F in h||(F=k(c)[H]||F),F in h)switch(typeof h[F]){case "string":p[F]=x;break;case "number":p[F]=x.length?Number(x):NaN;break;case "boolean":p[F]="false"!=x.toLowerCase();break;case "function":""===x||-1!=x.search(/[^\w\.]+/i)?p[F]=new Function(x):p[F]=d.getObject(x,!1)||new Function(x);r.push(F);break;default:H=h[F],p[F]=H&&"length"in H?x?x.split(/\s*,\s*/):[]:H instanceof Date?""==x?new Date(""):
"now"==x?new Date:u.fromISOString(x):H instanceof z?m.baseUrl+x:G(x)}else p[F]=x}}for(v=0;v<r.length;v++)w=r[v].toLowerCase(),a.removeAttribute(w),a[w]=null;if(B)try{B=G.call(g.propsThis,"{"+B+"}"),d.mixin(p,B)}catch(M){throw Error(M.toString()+" in data-dojo-props\x3d'"+B+"'");}d.mixin(p,b);l||(l=c&&(c._noScript||h._noScript)?[]:A("\x3e script[type^\x3d'dojo/']",a));var I=[],L=[],K=[],J=[];if(l)for(q=0;q<l.length;q++)w=l[q],a.removeChild(w),b=w.getAttribute(f+"event")||w.getAttribute("event"),g=
w.getAttribute(f+"prop"),B=w.getAttribute(f+"method"),r=w.getAttribute(f+"advice"),v=w.getAttribute("type"),w=this._functionFromScript(w,f),b?"dojo/connect"==v?I.push({method:b,func:w}):"dojo/on"==v?J.push({event:b,func:w}):p[b]=w:"dojo/aspect"==v?I.push({method:B,advice:r,func:w}):"dojo/watch"==v?K.push({prop:g,func:w}):L.push(w);c=(l=c.markupFactory||h.markupFactory)?l(p,a,c):new c(p,a);return c.then?c.then(e):e(c)},scan:function(b,a){function e(a){if(!a.inherited){a.inherited={};var c=a.node,b=
e(a.parent),c={dir:c.getAttribute("dir")||b.dir,lang:c.getAttribute("lang")||b.lang,textDir:c.getAttribute(n)||b.textDir},f;for(f in c)c[f]&&(a.inherited[f]=c[f])}return a.inherited}var d=[],k=[],f={},g=(a.scope||m._scopeName)+"Type",h="data-"+(a.scope||m._scopeName)+"-",v=h+"type",n=h+"textdir",h=h+"mixins",q=b.firstChild,x=a.inherited;if(!x){var w=function(a,c){return a.getAttribute&&a.getAttribute(c)||a.parentNode&&w(a.parentNode,c)},x={dir:w(b,"dir"),lang:w(b,"lang"),textDir:w(b,n)},u;for(u in x)x[u]||
delete x[u]}u={inherited:x};for(var z,A;;)if(q)if(1!=q.nodeType)q=q.nextSibling;else if(z&&"script"==q.nodeName.toLowerCase())(x=q.getAttribute("type"))&&/^dojo\/\w/i.test(x)&&z.push(q),q=q.nextSibling;else if(A)q=q.nextSibling;else if(x=q.getAttribute(v)||q.getAttribute(g),b=q.firstChild,x||b&&(3!=b.nodeType||b.nextSibling)){A=null;if(x){var B=q.getAttribute(h);z=B?[x].concat(B.split(/\s*,\s*/)):[x];try{A=c(z,a.contextRequire)}catch(I){}A||t.forEach(z,function(a){~a.indexOf("/")&&!f[a]&&(f[a]=!0,
k[k.length]=a)});B=A&&!A.prototype._noScript?[]:null;u={types:z,ctor:A,parent:u,node:q,scripts:B};u.inherited=e(u);d.push(u)}else u={node:q,scripts:z,parent:u};z=B;A=q.stopParser||A&&A.prototype.stopParser&&!a.template;q=b}else q=q.nextSibling;else{if(!u||!u.node)break;q=u.node.nextSibling;A=!1;u=u.parent;z=u.scripts}var C=new D;k.length?(y("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+k.join(", ")),(a.contextRequire||r)(k,function(){C.resolve(t.filter(d,function(b){if(!b.ctor)try{b.ctor=
c(b.types,a.contextRequire)}catch(J){}for(var e=b.parent;e&&!e.types;)e=e.parent;var f=b.ctor&&b.ctor.prototype;b.instantiateChildren=!(f&&f.stopParser&&!a.template);b.instantiate=!e||e.instantiate&&e.instantiateChildren;return b.instantiate}))})):C.resolve(d);return C.promise},_require:function(c,a){c=G("{"+c.innerHTML+"}");var b=[],k=[],l=new D;a=a&&a.contextRequire||r;for(var f in c)b.push(f),k.push(c[f]);a(k,function(){for(var a=0;a<b.length;a++)d.setObject(b[a],arguments[a]);l.resolve(arguments)});
return l.promise},_scanAmd:function(c,a){var b=new D,d=b.promise;b.resolve(!0);var k=this;A("script[type\x3d'dojo/require']",c).forEach(function(c){d=d.then(function(){return k._require(c,a)});c.parentNode.removeChild(c)});return d},parse:function(c,a){!c||"string"==typeof c||"nodeType"in c||(a=c,c=a.rootNode);var e=c?b.byId(c):q.body();a=a||{};var k=a.template?{template:!0}:{},l=[],f=this;c=this._scanAmd(e,a).then(function(){return f.scan(e,a)}).then(function(c){return f._instantiate(c,k,a,!0)}).then(function(a){return l=
l.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});d.mixin(l,c);return l}};m.parser=x;g.parseOnLoad&&B(100,x,"parse");return x})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(r,m){var d={};r.setObject("dojo.date.stamp",d);d.fromISOString=function(t,g){d._isoRegExp||(d._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var b=d._isoRegExp.exec(t);t=null;
if(b){b.shift();b[1]&&b[1]--;b[6]&&(b[6]*=1E3);g&&(g=new Date(g),m.forEach(m.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(b){return g["get"+b]()}),function(d,g){b[g]=b[g]||d}));t=new Date(b[0]||1970,b[1]||0,b[2]||1,b[3]||0,b[4]||0,b[5]||0,b[6]||0);100>b[0]&&t.setFullYear(b[0]||1970);var q=0,r=b[7]&&b[7].charAt(0);"Z"!=r&&(q=60*(b[8]||0)+(Number(b[9])||0),"-"!=r&&(q*=-1));r&&(q-=t.getTimezoneOffset());q&&t.setTime(t.getTime()+6E4*q)}return t};d.toISOString=function(d,
g){var b=function(b){return 10>b?"0"+b:b};g=g||{};var q=[],m=g.zulu?"getUTC":"get",n="";"time"!=g.selector&&(n=d[m+"FullYear"](),n=["0000".substr((n+"").length)+n,b(d[m+"Month"]()+1),b(d[m+"Date"]())].join("-"));q.push(n);"date"!=g.selector&&(n=[b(d[m+"Hours"]()),b(d[m+"Minutes"]()),b(d[m+"Seconds"]())].join(":"),m=d[m+"Milliseconds"](),g.milliseconds&&(n+="."+(100>m?"0":"")+b(m)),g.zulu?n+="Z":"time"!=g.selector&&(d=d.getTimezoneOffset(),g=Math.abs(d),n+=(0<d?"-":"+")+b(Math.floor(g/60))+":"+b(g%
60)),q.push(n));return q.join("T")};return d})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(r,m,d,t,g,b){return r([b,g],{_onMap:function(b){var d=this.constructor._onMap,g;d&&d.FINAL||(delete this.constructor._onMap,d=this.registerConnectEvents(),d.FINAL=!0);b=b.toLowerCase();d[b]?g=this[d[b].method]:(b=this._onCamelCase(b),this[b]&&(g=b));return g},on:function(b,d){var g=this._onMap(b),h=b.replace(/\-/g,
""),m="on"+h in this.domNode;return g||!m?this.inherited(arguments):this.own(t(this.domNode,h,d))[0]},emit:function(b,d,g){var h,q,n,r=b.toLowerCase(),t=this.constructor._onMap||this.registerConnectEvents();q=this[this._onMap(r)];d=d||{};d.target||(d.target=this);q&&t&&t[r]&&(this._onObj2Arr(function(){h=Array.prototype.slice.call(arguments)},t[r].argKeys)(d),n=m.mixin({},arguments),n[2]=h,n[0]=t[r].name.replace(/^on/,""));return this.inherited(n||arguments)}})})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/has","../kernel"],function(r,m,d,t,g){r=r(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],queryable:!1,showPopup:!1,constructor:function(b){b&&(this.name=b.name,this.title=b.title,this.description=b.description,this.extent=b.extent,this.legendURL=b.legendURL,this.subLayers=b.subLayers?b.subLayers:[],this.allExtents=b.allExtents?b.allExtents:[],
this.spatialReferences=b.spatialReferences?b.spatialReferences:[],this.queryable=!!b.queryable,this.showPopup=!!b.showPopup)},clone:function(){var b={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},g;this.extent&&(b.extent=this.extent.getExtent());b.subLayers=[];d.forEach(this.subLayers,function(d){b.subLayers.push(d.clone())});b.allExtents=[];for(g in this.allExtents)g=parseInt(g,10),isNaN(g)||(b.allExtents[g]=this.allExtents[g].getExtent());b.spatialReferences=
[];d.forEach(this.spatialReferences,function(d){b.spatialReferences.push(d)});b.queryable=this.queryable;b.showPopup=this.showPopup;return b}});t("extend-esri")&&m.setObject("layers.WMSLayerInfo",r,g);return r})},"*noref":1}});
define("esri/layers/WMSLayer","require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff ../config ../graphic ../kernel ../request ../urlUtils ../dijit/PopupTemplate ../SpatialReference ../geometry/Extent ../geometry/Point ./DynamicMapServiceLayer ./WMSLayerInfo dojo/query".split(" "),function(r,m,d,t,g,b,q,z,n,h,u,D,y,A,C,B,G){d=d([B],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,
2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,
27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],version:null,constructor:function(b,c){var d=u.urlToObject(b);d.query&&(d.query.version||d.query.Version||d.query.VERSION)&&(this.version=d.query.version||d.query.Version||d.query.VERSION);this.url=b=this._stripParameters(b,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));
this._url=u.urlToObject(b);this._getCapabilitiesURL=b;this._initLayer=t.hitch(this,this._initLayer);this._parseCapabilities=t.hitch(this,this._parseCapabilities);this._getCapabilitiesError=t.hitch(this,this._getCapabilitiesError);c?(this.customParameters=c.customParameters,this.customLayerParameters=c.customLayerParameters,this.imageFormat=this._getImageFormat(c.format),this.imageTransparency=!1!==c.transparent,this.visibleLayers=c.visibleLayers?c.visibleLayers:[],this.version=c.version||this.version,
c.resourceInfo?this._readResourceInfo(c.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=r.toUrl("../images/pixel.png");this.extentProcessor=this._createExtentProcessor(0);this._createChildLayer()},setVisibleLayers:function(b){this.visibleLayers=(b=this._checkVisibleLayersList(b))?b:[];this.refresh(!0)},setImageFormat:function(b){this.imageFormat=this._getImageFormat(b);this.refresh(!0)},
setImageTransparency:function(b){this.imageTransparency=b;this.refresh(!0)},setCustomParameters:function(b,c){this.customParameters=b;this.customLayerParameters=c;this.refresh(!0)},refresh:function(){this._refreshTS=Date.now();this.inherited(arguments);this._childLayer&&this._childLayer.refresh.apply(this._childLayer,arguments)},getImageUrl:function(b,c,d,g){if(this.visibleLayers&&0!==this.visibleLayers.length){b=this._getImageParams(b,c,d);b=this._mixinCustomLayerParameters(b);c=this.getMapURL;var k;
c+=-1===c.indexOf("?")?"?":"";for(k in b)b.hasOwnProperty(k)&&(c+="?"===c.substring(c.length-1,c.length)?"":"\x26",c+=k+"\x3d"+b[k]);c=this.addTimestampToURL(c);g(u.addProxy(c))}else g(this._blankImageURL)},_setMap:function(b,c,d){var k=this.inherited(arguments);b.wrapAround180?this._childLayer&&(this.suspended&&this._childLayer.suspend(),this._childLayer._setMap(b,k)):this._childLayer=this.extentProcessor=null;return k},_unsetMap:function(b,c){this._childLayer&&this._childLayer._unsetMap(b,this._div);
this.inherited(arguments)},onSuspend:function(){this.inherited(arguments);this._childLayer&&this._childLayer.suspend()},onResume:function(){this.inherited(arguments);this._childLayer&&this._childLayer.resume()},_createChildLayer:function(){this._childLayer=new B(null,{extentProcessor:this._createExtentProcessor(1)});this._childLayer._isChildLayer=!0;this._childLayer.getImageUrl=t.hitch(this,this.getImageUrl);this._childLayer.loaded=!0},_createExtentProcessor:function(b){return t.hitch(this,this._extentProcessor,
b)},_extentProcessor:function(b,c){var d=c.extent,k=c.width,g=0;if(d){c=d.getWidth()/k;var a=d.bisect(),d=a.extents,e=d[b];e&&(k=a.marginLeft/c,g=0===b?k:k+d[0].getWidth()/c,k=Math.ceil(e.getWidth()/c),g=Math.ceil(g));d=e}return{extent:d,width:k,marginLeft:g}},_getImageParams:function(b,c,d){var k=b.spatialReference.wkid;-1===g.indexOf(this.spatialReferences,k)&&b.spatialReference.latestWkid&&(k=b.spatialReference.latestWkid);if(g.some(this._WEB_MERCATOR,function(a){return a==k})){var h=g.filter(this.spatialReferences,
function(a){return g.some(this._WEB_MERCATOR,function(b){return b==a})},this);0===h.length&&(h=g.filter(this.spatialReferences,function(a){return g.some(this._WORLD_MERCATOR,function(b){return b==a})},this));k=0<h.length?h[0]:this._WEB_MERCATOR[1]}this.spatialReferences=g.filter(this.spatialReferences,function(a){return a!==k});this.spatialReferences.unshift(k);var h=b.xmin,a=b.xmax,e=b.ymin;b=b.ymax;var p={SERVICE:"WMS",REQUEST:"GetMap"};p.FORMAT=this.imageFormat;p.TRANSPARENT=this.imageTransparency?
"TRUE":"FALSE";p.STYLES="";p.VERSION=this.version;p.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;p.WIDTH=c;p.HEIGHT=d;this.maxWidth<c&&(p.WIDTH=this.maxWidth);this.maxHeight<d&&(p.HEIGHT=this.maxHeight);c=k?k:NaN;isNaN(c)||("1.3.0"==this.version?p.CRS="EPSG:"+c:p.SRS="EPSG:"+c);"1.3.0"==this.version&&this._useLatLong(c)?p.BBOX=e+","+h+","+b+","+a:p.BBOX=h+","+e+","+a+","+b;return p},_initLayer:function(d,c){this.spatialReference=new y(this.extent.spatialReference);this.initialExtent=
new A(this.extent);this.fullExtent=new A(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);var k=t.hitch(this,function(){this.loaded=!0;this.onLoad(this);var b=this._loadCallback;b&&(delete this._loadCallback,b(this))});b("chrome")?(d=q.defaults.io,c="with-credentials"===d.useCors?u.canUseXhr(this.getMapURL,!0):-1,(d=-1<c?d.corsEnabledServers[c]:null)&&d.withCredentials?h({url:this.getMapURL,handleAs:"text",content:{SERVICE:"WMS",REQUEST:"GetMap"}}).addBoth(function(){k()}):
k()):k()},_readResourceInfo:function(b){b.extent?b.layerInfos?(this.extent=b.extent,this.allExtents[0]=b.extent,this.layerInfos=b.layerInfos,this.description=b.description?b.description:"",this.copyright=b.copyright?b.copyright:"",this.title=b.title?b.title:"",this.getMapURL=b.getMapURL?b.getMapURL:this._getCapabilitiesURL,this.getFeatureInfoURL=b.getFeatureInfoURL,this.featureInfoFormat=b.featureInfoFormat,this.version=b.version?b.version:"1.3.0",this.maxWidth=b.maxWidth?b.maxWidth:5E3,this.maxHeight=
b.maxHeight?b.maxHeight:5E3,this.spatialReferences=b.spatialReferences?b.spatialReferences:[],this.imageFormat=this._getImageFormat(b.format),this.setScaleRange(b.minScale,b.maxScale),this.customLayerParameters=b.customLayerParameters||this.customLayerParameters,this.customParameters=b.customParameters||this.customParameters,this._initLayer()):this._errorHandler(Error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo")):this._errorHandler(Error("esri.layers.WMSLayer: Unable to find the 'extent' property in resourceInfo."))},
_getCapabilities:function(){var b=this._url.query?this._url.query:{};b.SERVICE="WMS";b.REQUEST="GetCapabilities";this.version&&(b.VERSION=this.version);var b=this._mixinCustomParameters(b),c=this._url.path+"?",d;for(d in b)b.hasOwnProperty(d)&&(c+="?"==c.substring(c.length-1,c.length)?"":"\x26",c+=d+"\x3d"+b[d]);h({url:c,handleAs:"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(b){if(b){var c=this;this.version=
this._getAttributeValue("WMS_Capabilities","version",b,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",b,"1.3.0"));var d=this._getTag("Service",b);this.title=this._getTagValue("Title",d,"");this.title||(this.title=this._getTagValue("Name",d,""));this.copyright=this._getTagValue("AccessConstraints",d,"");this.description=this._getTagValue("Abstract",d,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",d,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",
d,5E3),10);if(d=this._getTag("Layer",b)){var k=this._getLayerInfo(d),h=0,a=null,d=this._getTag("Capability",b);g.forEach(d.childNodes,function(b){"Layer"==b.nodeName&&(0===h?a=b:(1===h&&k.name&&(k.name="",k.subLayers=[],k.subLayers.push(this._getLayerInfo(a))),k.subLayers.push(this._getLayerInfo(b))),h++)},this);if(k&&(this.layerInfos=k.subLayers,this.layerInfos&&0!==this.layerInfos.length||(this.layerInfos=[k]),this.extent=k.extent,this.extent||(k.extent=new A(this.layerInfos[0].extent.toJson()),
this.extent=k.extent),this.allExtents=k.allExtents,this.allExtents&&this.allExtents.length||(k.allExtents=[],g.forEach(this.layerInfos[0].allExtents,function(a,b){a&&(k.allExtents[b]=new A(a.toJson()))}),this.allExtents=k.allExtents),this.spatialReferences=k.spatialReferences,!this.spatialReferences.length&&0<this.layerInfos.length))for(var e=function(a){var b;for(b=0;b<a.subLayers.length;b++){var c=a.subLayers[b],d=c.spatialReferences;!d.length&&c.subLayers&&0<c.subLayers.length&&(d=e(c));if(d.length)return d}return[]},
d=0;d<this.layerInfos.length;d++){var p=this.layerInfos[d];this.spatialReferences=this.layerInfos[0].spatialReferences;!this.spatialReferences.length&&p.subLayers&&0<p.subLayers.length&&(this.spatialReferences=e(p));if(this.spatialReferences.length)break}d=function(a){return(a=m.query("DCPType",c._getTag(a,b)))&&0<a.length&&(a=m.query("HTTP",a[0]))&&0<a.length&&(a=m.query("Get",a[0]))&&0<a.length&&(a=c._getAttributeValue("OnlineResource","xlink:href",a[0],null))?(a.indexOf("\x26")===a.length-1&&(a=
a.substring(0,a.length-1)),c._stripParameters(a,["service","request"])):null};p=function(a){var d=[];0===m.query("Operation",b).length?g.forEach(m.query("Format",c._getTag(a,b)),function(a){d.push(a.text?a.text:a.textContent)}):(g.forEach(m.query("Operation",b),function(b){b.getAttribute("name")===a&&g.forEach(m.query("Format",b),function(a){d.push(a.text?a.text:a.textContent)})}),d.length||g.forEach(m.query("Format",c._getTag(a,b)),function(a){d.push(a.text?a.text:a.textContent)}));return d};this.getMapURL=
d("GetMap")||this._getCapabilitiesURL;this.getMapFormats=p("GetMap");this.getMapFormats.length&&!g.some(this.getMapFormats,function(a){return-1<a.indexOf(this.imageFormat)},this)&&(this.imageFormat=this.getMapFormats[0]);if(this.getFeatureInfoURL=d("GetFeatureInfo"))this.getFeatureInfoFormats=p("GetFeatureInfo"),-1<g.indexOf(this.getFeatureInfoFormats,"text/html")?this.featureInfoFormat="text/html":-1<g.indexOf(this.getFeatureInfoFormats,"text/plain")&&(this.featureInfoFormat="text/plain");if(!this.featureInfoFormat){var l=
function(a){if(a&&(a.queryable=!1,a.subLayers))for(var b=0;b<a.subLayers.length;b++)l(a.subLayers[b])};l(k)}this._initLayer()}else this._errorHandler(Error("esri.layers.WMSLayer: Response does not contain any layers."))}else this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)"))},_getCapabilitiesError:function(b){b&&b.message&&(b.message="GetCapabilities request for "+this._getCapabilitiesURL+" failed. ("+b.message+")");this._errorHandler(b)},
_getLayerInfo:function(b){if(!b)return null;var c=new G;c.name="";c.title="";c.description="";c.allExtents=[];c.spatialReferences=[];c.queryable="1"===b.getAttribute("queryable");c.subLayers=[];var d=this._getTag("LatLonBoundingBox",b);d&&(c.allExtents[0]=this._getExtent(d,4326));var k=this._getTag("EX_GeographicBoundingBox",b),h;k&&(h=new A(0,0,0,0,new y({wkid:4326})),h.xmin=parseFloat(this._getTagValue("westBoundLongitude",k,0)),h.ymin=parseFloat(this._getTagValue("southBoundLatitude",k,0)),h.xmax=
parseFloat(this._getTagValue("eastBoundLongitude",k,0)),h.ymax=parseFloat(this._getTagValue("northBoundLatitude",k,0)),c.allExtents[0]=h);d||k||(h=new A(-180,-90,180,90,new y({wkid:4326})),c.allExtents[0]=h);c.extent=c.allExtents[0];var a=-1<g.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";g.forEach(b.childNodes,function(b){if("Name"==b.nodeName)c.name=(b.text?b.text:b.textContent)||"";else if("Title"==b.nodeName)c.title=(b.text?b.text:b.textContent)||"";else if("Abstract"==b.nodeName)c.description=
(b.text?b.text:b.textContent)||"";else if("BoundingBox"==b.nodeName){var d=b.getAttribute(a);d&&0===d.indexOf("EPSG:")?(d=parseInt(d.substring(5),10),0===d||isNaN(d)||(b="1.3.0"==this.version?this._getExtent(b,d,this._useLatLong(d)):this._getExtent(b,d),c.allExtents[d]=b,c.extent||(c.extent=b))):d&&0===d.indexOf("CRS:")?(d=parseInt(d.substring(4),10),0===d||isNaN(d)||(this._CRS_TO_EPSG[d]&&(d=this._CRS_TO_EPSG[d]),c.allExtents[d]=this._getExtent(b,d))):(d=parseInt(d,10),0===d||isNaN(d)||(c.allExtents[d]=
this._getExtent(b,d)))}else if(b.nodeName==a)b=(b.text?b.text:b.textContent).split(" "),g.forEach(b,function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0===a||isNaN(a)||(this._CRS_TO_EPSG[a]&&(a=this._CRS_TO_EPSG[a]),-1==g.indexOf(c.spatialReferences,a)&&c.spatialReferences.push(a))},this);else if("Style"!=b.nodeName||c.legendURL)"Layer"===b.nodeName&&c.subLayers.push(this._getLayerInfo(b));else if(b=this._getTag("LegendURL",b))if(b=this._getTag("OnlineResource",b))c.legendURL=
b.getAttribute("xlink:href")},this);c.title=c.title||c.name;return c},_getImageFormat:function(b){switch(b?b.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";case "gif":return"image/gif";case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},
_getExtent:function(b,c,d){var k;if(b){k=new A;var g=parseFloat(b.getAttribute("minx")),a=parseFloat(b.getAttribute("miny")),e=parseFloat(b.getAttribute("maxx"));b=parseFloat(b.getAttribute("maxy"));d?(k.xmin=isNaN(a)?-1*Number.MAX_VALUE:a,k.ymin=isNaN(g)?-1*Number.MAX_VALUE:g,k.xmax=isNaN(b)?Number.MAX_VALUE:b,k.ymax=isNaN(e)?Number.MAX_VALUE:e):(k.xmin=isNaN(g)?-1*Number.MAX_VALUE:g,k.ymin=isNaN(a)?-1*Number.MAX_VALUE:a,k.xmax=isNaN(e)?Number.MAX_VALUE:e,k.ymax=isNaN(b)?Number.MAX_VALUE:b);k.spatialReference=
new y({wkid:c})}return k},_useLatLong:function(b){var c,d;for(d=0;d<this._REVERSED_LAT_LONG_RANGES.length;d++){var k=this._REVERSED_LAT_LONG_RANGES[d];if(b>=k[0]&&b<=k[1]){c=!0;break}}return c},_getTag:function(b,c){return(b=m.query(b,c))&&0<b.length?b[0]:null},_getTagValue:function(b,c,d){return(b=m.query(b,c))&&0<b.length?b[0].text?b[0].text:b[0].textContent:d},_getAttributeValue:function(b,c,d,g){return(b=m.query(b,d))&&0<b.length?b[0].getAttribute(c):g},_checkVisibleLayersList:function(b){if(b&&
0<b.length&&this.layerInfos&&0<this.layerInfos.length&&"number"==typeof b[0]){var c=[];g.forEach(b,function(b){b<this.layerInfos.length&&c.push(this.layerInfos[b].name)},this);b=c}return b},_stripParameters:function(b,c){b=u.urlToObject(b);var d,k=[];for(d in b.query)b.query.hasOwnProperty(d)&&-1===g.indexOf(c,d.toLowerCase())&&k.push(d+"\x3d"+b.query[d]);return b.path+(k.length?"?"+k.join("\x26"):"")},_getPopupGraphic:function(b,c){var d=this.visibleLayers;if(!d||0===d.length)return null;var h=this._popupGraphic;
h||(h=new D({title:this.title||"",description:'\x3cdiv style\x3d"position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;"\x3e\x3ciframe src\x3d"{QUERY_URL}" width\x3d"250" height\x3d"147" frameborder\x3d"0" marginwidth\x3d"0" marginheight\x3d"0" style\x3d"position:absolute;top:0;left:0;width:100%;height:100%;border:0;background:url(\''+r.toUrl("../dijit/images/loading-throb.gif")+"') transparent center no-repeat;\" onload\x3d\"(event.target || event.srcElement).style.background \x3d 'none';\"\x3e\x3c/iframe\x3e\x3c/div\x3e"}),
h=this._popupGraphic=new z(null,null,{},h),h._layer=this);var k=function(a){var b=[];if(a&&(a.queryable&&a.showPopup&&a.name&&b.push(a.name),a.subLayers))for(var c=0;c<a.subLayers.length;c++){var d=k(a.subLayers[c]);d.length&&(b=b.concat(d))}return b},a=k({subLayers:this.layerInfos}),a=g.filter(a,function(a){return-1<g.indexOf(d,a)});if(a.length){var e=this.getFeatureInfoURL;b=this._getImageParams(b.extent,b.width,b.height);b=this._mixinCustomLayerParameters(b);b.REQUEST="GetFeatureInfo";b.INFO_FORMAT=
this.featureInfoFormat;b.QUERY_LAYERS=a.join();b.FEATURE_COUNT=25;"1.3.0"===this.version?(b.I=Math.round(c.x),b.J=Math.round(c.y)):(b.X=Math.round(c.x),b.Y=Math.round(c.y));var e=e+(-1===e.indexOf("?")?"?":""),m;for(m in b)b.hasOwnProperty(m)&&(e+="?"===e.substring(e.length-1,e.length)?"":"\x26",e+=m+"\x3d"+b[m]);h.attributes.QUERY_URL=e;return h}return null},_mixinCustomParameters:function(b){if(this.customParameters)for(var c in this.customParameters)b[c]=encodeURIComponent(this.customParameters[c]);
return b},_mixinCustomLayerParameters:function(b){if(this.customLayerParameters||this.customParameters){var c=t.clone(this.customParameters||{});t.mixin(c,this.customLayerParameters||{});for(var d in c)"styles"===d.toLowerCase()&&delete b.STYLES,b[d]=encodeURIComponent(c[d])}return b}});b("extend-esri")&&t.setObject("layers.WMSLayer",d,n);return d});